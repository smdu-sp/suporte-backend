// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Permissao {
  DEV
  ADM
  TEC
  USR
}

model Usuario {
  id            String    @id @default(uuid())
  nome          String
  login         String    @unique
  email         String    @unique
  permissao     Permissao @default(USR)
  status        Int       @default(1)

  ultimologin   DateTime @default(now())
  criadoEm      DateTime @default(now())
  atualizadoEm  DateTime @default(now()) @updatedAt

  ordens        Ordem[]
  servicos      Servico[]
  unidade       Unidade? @relation(fields: [unidade_id], references: [id])
  unidade_id    String?

  @@map("usuarios")
}

model Unidade {
  id     String  @id @default(uuid())
  nome   String  @unique
  sigla  String  @unique
  codigo String  @unique
  status Boolean @default(true)

  usuarios Usuario[]
  ordens   Ordem[]

  @@map("unidades")
}

model Ordem { //ordem de servi√ßo
  id               String       @id
  unidade_id       String
  unidade          Unidade      @relation(fields: [unidade_id], references: [id])
  andar            Int
  sala             String
  solicitante      Usuario      @relation(fields: [solicitante_id], references: [id])
  solicitante_id   String
  tratar_com       String?
  telefone         String       @default("")
  data_solicitacao DateTime     @default(now())
  status           Int          @default(1)
  prioridade       Int          @default(1)
  observacoes      String
  servicos         Servico[]
  tipo_id          String
  tipo             Tipo         @relation(fields: [tipo_id], references: [id])
  categoria_id     String
  categoria        Categoria    @relation(fields: [categoria_id], references: [id])
  subcategoria_id  String
  subcategoria     Subcategoria @relation(fields: [subcategoria_id], references: [id])

  @@map("ordens")
}

model Servico {
  id          String      @id @default(uuid())
  data_inicio DateTime    @default(now())
  data_fim    DateTime?
  descricao   String?
  materiais   Material[]
  suspensoes  Suspensao[]
  ordem       Ordem       @relation(fields: [ordem_id], references: [id])
  ordem_id    String
  avaliado_em DateTime?
  status      Int         @default(1)
  observacao  String?
  tecnicos    Usuario[]

  @@map("servicos")
}

model Suspensao {
  id         String    @id @default(uuid())
  servico_id String
  servico    Servico   @relation(fields: [servico_id], references: [id])
  motivo     String
  inicio     DateTime  @default(now())
  termino    DateTime?
  status     Boolean   @default(true)

  @@map("suspensoes")
}

model SugestaoMaterial {
  id   String @id @default(uuid())
  nome String @unique

  @@map("sugestao_materiais")
}

model Material {
  id         String @id @default(uuid())
  nome       String
  quantidade Float
  medida     String

  servico_id String
  servico    Servico @relation(fields: [servico_id], references: [id])

  @@map("materiais")
}

model Tipo {
  id           String @id @default(uuid())
  nome         String @unique
  categorias   Categoria[]
  ordens       Ordem[]
  status       Boolean @default(true)

  @@map("tipos")
}

model Categoria {
  id            String  @id @default(uuid())
  nome          String  @unique
  tipo_id       String
  tipo          Tipo    @relation(fields: [tipo_id], references: [id])
  subcategorias Subcategoria[]
  ordens        Ordem[]
  status        Boolean @default(true)

  @@map("categorias")
}

model Subcategoria {
  id           String @id @default(uuid())
  nome         String @unique
  categoria_id String
  categoria    Categoria @relation(fields: [categoria_id], references: [id])
  ordens       Ordem[]
  status       Boolean @default(true)

  @@map("subcategoria")
}
